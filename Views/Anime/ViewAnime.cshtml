@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <style>
        /* General CSS */
        body {
            background: url(/Content/Backgrounds/bg-15.jpg);
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-position: center;
        }

        /* CSS for anime detail container */
        .anime-details {
            padding: 3%;
            margin-top: 3%;
            margin-bottom: 3%;
            border-radius: 0.5rem;
            background: #fff;
        }

        /* Anime poster */
        .details-poster {
            text-align: center;
            padding: 0;
            padding-top: 5px;
        }

            .details-poster img {
                width: 80%;
                height: 100%;
            }

        .details-head h5 {
            color: #333;
        }

        .details-head h6 {
            padding: 5px 0;
            color: #0056b3;
        }

        .details-head .nav-tabs {
            margin-bottom: 3%;
        }

            .details-head .nav-tabs .nav-link {
                font-weight: 400;
                border: none;
                color: #0056b3;
            }

                .details-head .nav-tabs .nav-link.active {
                    border: none;
                    font-weight: 700;
                    color: #0056b3;
                    border-bottom: 2px solid #0056b3;
                }

        /* Anime details */

        .details-input-form {
            padding: 5%;
            margin: 0;
            text-align: center;
        }

            .details-input-form p {
                font-size: 12px;
                color: #818182;
                font-weight: 600;
                margin-top: 10%;
            }

            .details-input-form a {
                text-decoration: none;
                color: #3333FF;
                font-weight: 600;
                font-size: 14px;
            }

            .details-input-form ul {
                list-style: none;
            }

        .details-tab label {
            font-weight: 600;
        }

        .details-tab p {
            font-weight: 600;
            color: #0056b3;
        }

        /* Miscellaneous CSS */

        #details{
            line-height: 2rem;
            padding: 0 0.5rem;
        }

        .synopsis {
            color: #000000 !important;

            font-weight: normal !important;
            line-height: 2rem;
        }

        .btn-group {
            margin-top: 15%;
            width: 200px;
        }

        .addtolist-block {
            padding-bottom: 40px;
            padding-top: 5px;
        }

        /* Add To List button CSS */

        .btn-primary {
            background-color: #fff;
            width: 90%;
            margin-top: 1%;
            margin-bottom: 6%;
            color: #0056b3;
            border-color: #0056b3;
        }

            .btn-primary:hover {
                background-color: #0056b3;
            }

            .btn-primary:focus {
                background-color: #0056b3;
            }

        /* Spaceit class for madding and margin */
        .spaceit {
            margin: 3px 0;
            padding: 3px 0;
        }

        #addtolist {
            padding: 0 !important;
        }

        #collapsePanel {
            width: 90% !important;
            margin: 0 auto;
        }

        span.anime-list-notice {
            display: block;
            text-align: left;
        }

        /* Input Form CSS */

        .card.card-body {
            padding: 15px;
            margin-top: 0;
            padding-bottom: 5px;
        }

        form {
            display: block;
            text-align: center;
        }

        table {
            padding: 0;
            display: block;
            margin: 0 !important;
            border-collapse: separate;
            border-spacing: 1px 10px;
        }

        tbody {
            display: block;
            width: 100%;
            margin: 0;
        }

        .statustr .epstr .submittr {
            display: block;
            width: 100%;
        }

        .status {
            text-align: left;
            padding-left: 2%;
        }

        .epseen {
            padding-left: 2%;
            text-align: left;
            width: 40%;
        }

        .epseeninput {
            text-align: left;
            margin-right: 1px !important;
        }

        .submittr {
            text-align: right;
        }

        .input-button {
            text-align: right;
            margin: 2px;
            border-radius: 2px;
            border: 1px solid;
        }

        .submittd {
            display: block;
            text-align: right;
        }

        #status_dropdown {
            border: 1px solid #ced4da;
            font-size: 0.95rem;
            padding: 0;
        }

        #watchedeps {
            border: 1px solid #ced4da;
            font-size: 1rem;
            width: 35%;
        }

        input-button {
            margin-top: 5%;
        }

        /* Responsive CSS */
        @@media (max-width: 768px) {
            .details-head {
                text-align: center;
            }

            .submittd {
                margin: 0;
                padding: 6px 0;
            }

            .details-poster img {
                max-width: 100%;
                height: auto;
                width: auto;
            }

            .status {
                float: initial;
                width: initial;
            }

            .statusinput {
                display: initial;
                float: initial;
                width: initial;
                margin-bottom: 3px;
                padding-bottom: 3px;
            }

                .statusinput select {
                    float: initial;
                    width: initial;
                }

            .epstr {
                float: initial;
                width: initial;
            }

            .epseen .epseeninput {
                margin-top: 3px 0;
                padding-top: 3px 0;
                display: initial;
                float: initial;
                width: initial;
            }

            #watchedeps {
                width: 35%;
            }

            .submittr {
                display: block;
            }
        }

        @@media (min-width: 1200px) {
            .details-head {
                text-align: initial;
            }

            .submittd {
                margin: 3px 0;
                padding: 6px 0;
            }

            .details-poster img {
                width: 80%;
                height: 100%;
            }

            .status {
                float: initial;
                width: initial;
            }

            .statusinput {
                display: initial;
                float: initial;
                width: initial;
                margin-bottom: 3px;
                padding-bottom: 3px;
            }

                .statusinput select {
                    float: initial;
                    width: initial;
                }

            .epstr {
                float: initial;
                width: initial;
            }

            .epseen .epseeninput {
                margin-top: 3px 0;
                padding-top: 3px 0;
                display: initial;
                float: initial;
                width: initial;
            }

            #watchedeps {
                width: 35%;
            }

            .submittr {
                display: block;
            }
        }

        @@media (min-width: 768px) and (max-width: 1200px) {
            .details-head {
                text-align: initial;
            }

            .submittd {
                margin: 3px 0;
                padding: 6px 0;
            }

            .details-poster img {
                width: 80%;
                height: 100%;
            }

            .status {
                display: block;
                float: left;
                width: 100%;
            }

            .statusinput {
                display: block;
                float: left;
                width: 100%;
                margin-bottom: 0px;
                padding-bottom: 0px;
            }

                .statusinput select {
                    width: 100%;
                }

            .epstr {
                display: block;
                float: left;
                width: 100%;
            }

            .epseen {
                margin-top: 0;
                padding-top: 0;
                display: block;
                float: left;
                width: 100%;
            }

            .epseeninput {
                margin-top: 3px 0;
                padding-top: 3px 0;
                display: block;
                float: left;
                width: 100%;
            }

            #watchedeps {
                width: 42%;
            }

            .submitfiller {
                display: none;
            }
        }

        .submittr {
            float: right;
        }

        /* Hide input arrows */
        /* Chrome, Safari, Edge, Opera */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Firefox */
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
    <title>@ViewBag.Anime.Name - WibuAnimeList</title>
</head>
<body>
    <!-- Container for anime details -->
    <div class="container anime-details">
        <div class="row">
            <!-- Anime poster and input form -->
            <div class="col-md-4">
                <div class="details-poster">
                    <img class="rounded " src="~/Content/Images/Posters/@ViewBag.Anime.Poster" alt="" />
                </div>
                <div class="details-input-form">
                    <!-- Check if user logged in -->
                    @if (Session["User"] != null)
                    {
                        <!-- Check if user has anime in list -->
                        if (ViewBag.AnimeInList != null)
                        {
                            <!-- Show anime edit and remove form -->
                            <div class="collapse show" id="collapsePanel">
                                <div class="card card-body">
                                    <div id="addtolist" class="addtolist-block">
                                        <span class="anime-list-notice">* Note: Anyone can view your list by default.</span>
                                        <form action="@Url.Action("AddRemoveAnimeList", "Anime")" method="POST">
                                            <table>
                                                <input type="hidden" name="animeId" value="@ViewBag.Anime.Id" />
                                                <input type="hidden" name="accountId" value="@((Session["User"] as FDMSWeb.Models.Account).Id)" />
                                                <tbody>
                                                    <!-- Row for status and status dropdown menu input -->
                                                    <tr class="statustr">
                                                        <td class="status spaceit">Status:</td>
                                                        <td class="statusinput spaceit">
                                                            <select name="status" id="status_dropdown" class="inputtext form-control-sm">
                                                                <!-- Add statuses from status list to drop down list -->
                                                                @{int statusIndex = 1; }
                                                                @foreach (string status in ViewBag.StatusList)
                                                                {
                                                                    /* Select anime in list status as default */
                                                                    if (!status.Equals(ViewBag.AnimeInList.Status))
                                                                    {
                                                                        <option value="@statusIndex"> @status </option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="@statusIndex" selected="selected">  @status  </option>
                                                                    }
                                                                    statusIndex++;
                                                                }
                                                            </select>
                                                        </td>
                                                    </tr>
                                                    <!-- Row for eps seen and episode input -->
                                                    <tr class="epstr">
                                                        <td class="epseen spaceit">Eps Seen:</td>
                                                        <td class="epseeninput spaceit">
                                                            <input type="hidden" name="episode" value="@ViewBag.Anime.Episodes" />
                                                            <input type="number" min="0" max="9999" id="watchedeps" name="progress" size="3" class="inputtext form-control-sm" value="@ViewBag.AnimeInList.Progress" required />
                                                            @Html.Raw("/")
                                                            <!-- Check if anime is still currently airing -->
                                                            @if (ViewBag.Anime.Episodes != 0)
                                                            {
                                                                @ViewBag.Anime.Episodes
                                                            }
                                                            else
                                                            {
                                                                @Html.Raw("?")
                                                            }
                                                        </td>
                                                    </tr>
                                                    <!-- Row for edit and remove button -->
                                                    <tr class="submittr">
                                                        <td class="submittd">
                                                            <input id="edit-button" type="submit" name="btnAction" value="Edit" class="input-button edit-button">
                                                            <input type="submit" name="btnAction" value="Remove" class="input-button" onclick="return confirm('Are you sure you want to remove \'@ViewBag.Anime.Name\' from your list?');">
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        }
                        else
                        {
                            <!-- Show Add to List button -->
                            <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapsePanel" aria-expanded="false" aria-controls="collapsePanel">
                                Add To List
                            </button>
                            <!-- Show anime add form -->
                            <div class="collapse" id="collapsePanel">
                                <div class="card card-body">
                                    <div id="addtolist" class="addtolist-block">
                                        <span class="anime-list-notice">* Note: Anyone can view your list by default.</span>
                                        <form action="@Url.Action("AddRemoveAnimeList", "Anime")" method="POST">
                                            <table>
                                                <input type="hidden" name="animeId" value="@ViewBag.Anime.Id" />
                                                <input type="hidden" name="accountId" value="@((Session["User"] as FDMSWeb.Models.Account).Id)" />
                                                <tbody>
                                                    <!-- Row for status and status dropdown menu input -->
                                                    <tr class="statustr">
                                                        <td class="status spaceit">Status:</td>
                                                        <td class="statusinput spaceit">
                                                            <select name="status" id="status_dropdown" class="inputtext form-control-sm">
                                                                @{int statusIndex = 1; }
                                                                <!-- Add statuses from status list to drop down list -->
                                                                @foreach (string status in ViewBag.StatusList)
                                                                {
                                                                    <option value="@statusIndex"> @status </option>
                                                                    statusIndex++;
                                                                }
                                                            </select>
                                                        </td>
                                                    </tr>
                                                    <!-- Row for eps seen and episode input -->
                                                    <tr class="epstr">
                                                        <td class="epseen spaceit">Eps Seen:</td>
                                                        <td class="epseeninput spaceit">
                                                            <input type="hidden" name="episode" value="@ViewBag.Anime.Episodes" />
                                                            <input type="number" min="0" max="9999" id="watchedeps" name="progress" size="1" class="inputtext form-control-sm" value="0" required />
                                                            @Html.Raw("/")
                                                            <!-- Check if anime is still currently airing -->
                                                            @if (ViewBag.Anime.Episodes != 0)
                                                            {
                                                                @ViewBag.Anime.Episodes
                                                            }
                                                            else
                                                            {
                                                                @Html.Raw("?")
                                                            }
                                                        </td>
                                                    </tr>
                                                    <!-- Row for add button -->
                                                    <tr class="submittr">
                                                        <td class="submittd">
                                                            <input id="addButton" type="submit" name="btnAction" value="Add" class="input-button addButton">
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        }
                    }
                </div>
            </div>
            <!-- Display anime details -->
            <div class="col-md-8">
                <div class="details-head">
                    <h1>
                        @Html.Raw(ViewBag.Anime.Name)
                    </h1>
                    @if (@ViewBag.Anime.Season.Id != 0)
                    {
                        <h6>@Html.Raw(ViewBag.Anime.Season.Name)</h6>
                    }
                    else
                    {
                        <h6>Unknown Season</h6>
                    }

                    <!-- Navigation bar to navigate between Synopsis, Details and Trailer tabs -->
                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="synopsis-tab" data-toggle="tab" href="#synopsis" role="tab" aria-controls="synopsis" aria-selected="true">Synopsis</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="details-tab" data-toggle="tab" href="#details" role="tab" aria-controls="details" aria-selected="false">Details</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="trailer-tab" data-toggle="tab" href="#trailer" role="tab" aria-controls="trailer" aria-selected="false">Trailer</a>
                        </li>
                    </ul>
                </div>

                <!-- Content for tabs -->
                <div class="tab-content details-tab" id="myTabContent">
                    <!-- Content for Synopsis tab -->
                    <div class="tab-pane fade show active" id="synopsis" role="tabpanel" aria-labelledby="synopsis-tab">
                        <p class="synopsis text-justify">@Html.Raw(ViewBag.Anime.Description)</p>
                    </div>

                    <!-- Content for Details tab -->
                    <div class="tab-pane fade" id="details" role="tabpanel" aria-labelledby="details-tab">
                        <div class="row">
                            <div class="col-md-6">
                                <label>Type</label>
                            </div>
                            <div class="col-md-6">
                                <p>@Html.Raw(ViewBag.Anime.Type)</p>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <label>Episodes</label>
                            </div>
                            <!-- Check if anime is still airing -->
                            <div class="col-md-6">
                                @if (ViewBag.Anime.Episodes != 0)
                                {
                                    <p>@Html.Raw(ViewBag.Anime.Episodes)</p>
                                }
                                else
                                {
                                    <p>?</p>
                                }
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <label>Status</label>
                            </div>
                            <div class="col-md-6">
                                <p>@Html.Raw(ViewBag.Anime.Status)</p>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <label>Release Date</label>
                            </div>
                            <!-- Check if release date is null -->
                            <div class="col-md-6">
                                @if (ViewBag.Anime.ReleaseDate != null)
                                {
                                    <p>@Html.Raw(ViewBag.Anime.ReleaseDate)</p>
                                }
                                else
                                {
                                    <p>?</p>
                                }
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <label>Studio(s)</label>
                            </div>
                            <!-- Display multiple studios with "," -->
                            <div class="col-md-6 text-wrap">
                                <p>
                                    @{ int studioIndex = 0; }
                                    @foreach (FDMSWeb.Models.Studio studio in ViewBag.Studios)
                                    {
                                        // if there is only one studio
                                        if (studioIndex == 0 && ViewBag.Studios.Count == 1)
                                        {
                                            @Html.Raw(studio.Name)
                                        }
                                        // if there is more than one studio for the anime
                                        else if (studioIndex == 0)
                                        {
                                            @Html.Raw(studio.Name)
                                        }
                                        else
                                        {
                                            @Html.Raw(", " + studio.Name)
                                        }
                                        studioIndex++;
                                    }
                                </p>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <label>Genre(s)</label>
                            </div>
                            <!-- Display multiple genres with "," -->
                            <div class="col-md-6 text-wrap">
                                <p>
                                    @{ int genreIndex = 0; }
                                    @foreach (FDMSWeb.Models.Genre genre in ViewBag.Genres)
                                    {
                                        // if there is only one genre
                                        if (genreIndex == 0 && ViewBag.Genres.Count == 1)
                                        {
                                            @Html.Raw(genre.Name)
                                        }
                                        // if there is more than one genre for the anime
                                        else if (genreIndex == 0)
                                        {
                                            @Html.Raw(genre.Name)
                                        }
                                        else
                                        {
                                            @Html.Raw(", " + genre.Name)
                                        }
                                        genreIndex++;
                                    }
                                </p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <label>Duration</label>
                            </div>
                            <!-- Check if duration is null -->
                            <div class="col-md-6">
                                @if (@ViewBag.Anime.Duration != null)
                                {
                                    <p>@Html.Raw(ViewBag.Anime.Duration)</p>
                                }
                                else
                                {
                                    <p>&lt;Unknown Length&gt;</p>
                                }
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <label>Rating</label>
                            </div>
                            <div class="col-md-6">
                                <p>@Html.Raw(ViewBag.Anime.Rating)</p>
                            </div>
                        </div>
                    </div>

                    <!-- Check if trailer is null -->
                    <div class="tab-pane fade" id="trailer" role="tabpanel" aria-labelledby="trailer-tab">
                        @if (@ViewBag.Anime.Trailer != null)
                        {
                            <div class="embed-responsive embed-responsive-16by9 text-center">
                                <iframe class="embed-responsive-item pl-3 pr-3 pt-0" src="@Html.Raw(ViewBag.Anime.Trailer)?rel=0" frameborder="0" allow="encrypted-media" allowfullscreen></iframe>
                            </div>
                        }
                        else
                        {
                            <p class="text-center text-black">There is no trailer available for this Anime title</p>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* Script to disallow users to add currently airing animes with status Completed to list*/
        $(document).ready(function () {
             /* Script for add button */
             $('#addButton').click(function () {
                if (@ViewBag.Anime.Episodes == 0 && $('#status_dropdown :selected').val() == 2) {
                    alert('You cannot mark the status as "Completed"! The anime is currently airing and has not yet finished airing!');
                    return false;
                };
            });

            /* Script for edit button */
            $('#edit-button').click(function () {
                if (@ViewBag.Anime.Episodes == 0 && $('#status_dropdown :selected').val() == 2) {
                    alert('You cannot change the status to "Completed"! The anime is currently airing and has not yet finished airing!');
                    return false;
                };
            });
        });

    </script>
</body>
</html>
